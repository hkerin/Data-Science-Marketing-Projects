---
title: 'SDGB-7844 Homework #3'
author: "Student_Name_Here"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### The USA Today Diversity Index

The USA TODAY Diversity Index is a number -- on a scale from 0 to 100 -- that represents the chance that two people chosen randomly from an area will be different by race and ethnicity. In more personal terms: "What is the chance that the next person I meet will be different from me?" A higher number means more diversity, a lower number, less. The index was invented in 1991 by Phil Meyer of the University of North Carolina and Shawn McIntosh of USA TODAY.

#### Exploratory Analysis

1. At what level (State, County, City) is the American Community Survey data available?  How is this different than the deccenial census?

**Answer:**


2. What variable and variable codes are available to describe race and ethnicity in the US Census?  Describe how these variables are represented in the data (Variables: B02001_001-B02001_006 & B03002_001-B03002_002 & B03002_012).

**Answer:**


3. How does the American Community Survey define race and ethnicity?  Is this important information to report under assumptions for your analysis?

**Answer:**


4. Does the American Community Survey provide the margin of error for their estimates of the proportion of the prevalence of each race and ethnicity?  How might this impact the validity of our results?

**Answer:**



5.  Use the _tidycensus_ API to assign the race and ethnicity data for New York, New Jersey and Connecticut (at the County level) to a data frame.

```{r}
library(tidycensus)
library(tidyverse)

census_api_key("d83f5c304f34de82156cfa7150eadd76c25bec69")
#B02001_001-B02001_006 & B03002_001-B03002_002 & B03002_012


#create a vector with the ACS race variables 
desired_vars = c(total= "B03002_001",
        nonhisp = "B03002_002",
      
        other = "B03002_008",
        multi = "B03002_009",
        hisp = "B03002_012",
        total="B02001_001",
        white = "B02001_002",
        baa = "B02001_003",
        amin = "B02001_004",
        asian = "B02001_005",
        nhopi = "B02001_006"
       )
 #create vector for the three states New York, CT, and NJ. 
 tristate_vec<-c("NJ","NY","CT")
#create dataframe called tristate with the race vector and tristate vector
 tristate <- get_acs(geography = "county", 
              variables = desired_vars,
              state = tristate_vec, 
              year = 2018)

tristate
```



#### Computing The USA Today Diversity Index

Each of the calculations below will be done **by county** and not in aggregate.

**Step 1:** 

In the current federal scheme, there are five named races – white, black/African-American, American Indian/Alaska Native, Asian and Native Hawaiian/Other Pacific Islander and an estimate for total population (B02001_001-B02001_006). Ensure that you have collected the proper data from the _tidycensus_ API for these values, as well as the values for the Hispanic population (B03002_001-B03002_002 & B03002_012).

Use the _spread_ function to create columns for each racial group (and the total population).  Rename these columns to better reflect the data if you have not already done so.


Calculate each group's share of the population.  This is done by dividing the value for each racial column by the total population column.  Create new variables for your data frame for each calculation.

$$ \small RaceProportion_i = \frac{Race_i}{Total_i} $$

```{r}

#change the name of variable to race and name to County_state
tristate <- tristate %>% 
         rename("Race" = "variable",
          "County_state" = "NAME")


#tristate
# group by finction by race and use geoid as row number
tristate <- tristate %>% 
  group_by(Race) %>% 
 mutate(moe = row_number())
tristate<-tristate %>% 
spread(Race, estimate) %>% 
  select(-moe)

tristate[is.na(tristate)] <- 0

tristate
#tristate
trial<-tristate %>%
  group_by(County_state) %>%
  summarise(across(c(total,amin, asian, baa, hisp, multi,  nhopi, nonhisp, other, white), sum, na.rm=FALSE))
trial

col_list<- c("amin", "asian", "baa", "hisp", "multi",  "nhopi", "nonhisp", "other","total", "white") 

#trial$total = apply(trial[,col_list], 1, sum)
#head(trial)
race<- c("amin", "asian", "baa", "hisp", "multi", "nhopi", "nonhisp", "other","total","white") 

# create new variable prop(proportion) by deviding race_estimate by total

 
prop<-colnames(trial[2:11])
race_estimate<-select(trial,2:11)
trial<-trial%>%
  mutate(prop=race_estimate/total)
```

**Step 2:**

Take each racial group's share of the population, square it and sum the results.

$$ \small P(Racial_i)  = \sum_{i=1}^{n} RaceProportion_i^2 $$

The Census also includes a category called "Some other race." Because studies show that people who check it are overwhelmingly Hispanic, that category is not used. Hispanics' effect on diversity is calculated in Step 3.

```{r}
sum_prop <- trial %>%
 select(c(12)) %>%
  sum_prop^2 %>%
  rowSums(.)

```


**Step 3: **

Because Hispanic origin is a separate Census question, the probability that someone is Hispanic or not must be figured separately.  Take the Hispanic and non-Hispanic percentages of the population, square each and add them to get the chance that any two people will be Hispanic or not.  Use this calculation to create a new variable in your data frame.

$$ \small P(Ethnic_i)  = Hispanic_i^2+ Non Hispanic_i^2 $$

```{r}

```


**Step 4:**

To calculate whether two people are the same on both measures, multiply the results of the first two steps.  Use this calculation to create a new column in your data frame.  This is the probability that any two people are the SAME by race and ethnicity. 

$$ \small P(Same_i)  = P(Racial_i) \times P(Ethnic_i) $$

```{r}

```


**Step 5:** 

Subtract the result from 1 to get the chance that two people are different – diverse. For ease of use, multiply the result by 100 to place it on a scale from 0 to 100.  Create a new column with your USA Today Diversity Index value.

$$ \small DiversityIndex_i =  \Big( 1 - P(Same_i) \Big) \times 100 $$

```{r}

```


#### Geo-spatial Analysis and Visualization

Be sure to properly label your plots and axes.  Points will be deducted for incorrect plot titles or axes.

6. Create a histogram of USA Today Diversity Index values.  Describe the shape of the histogram in statistical terms (Hint: skewness).

**Answer:**

```{r}

```


7. Create a visualization which compares the top 10 counties and their diversity index value using ggplot2.

```{r}

```


8. Using the _leaflet_ mapping library for R (or another mapping library of your choice), visualize the USA Today Diversity Index by county for New York, New Jersey and Connecticut.

```{r}

```



9.  Display the following data in the "tooltip" when mousing over your plot: USA Today Diversity Index Value and County Name.

```{r}

```



10.  Does there appear to be any relationship between geography and diversity?  Which state appears to be the most diverse?

**Answer:**

```{r}

```



#### Extra Credit

11.  Create a new data frame using the _tidycensus_ API with data on median household income by county for New York, New Jersey and Connecticut.  Join this data together with the data from New York County.  Use ggplot2 (or another visualization library) to visualize the USA Today Diversity Index value and median household incomeon the same plot (Hint: try facet wrap!).

```{r}

```



12.  Does there appear to be any relationship between median household income and diversity?  How do counties differ on these two measures?

**Answer:**

